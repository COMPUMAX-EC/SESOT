{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SESOT - Sistema Experto</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <script type="text/babel">
        import React, { useState, useRef, useEffect } from 'react';
        import { Send, Plus, MessageSquare, Cpu, Printer, Settings, Menu, X } from 'lucide-react';

        const SesotChatInterface = () => {
        const [conversations, setConversations] = useState([
            { id: 1, title: 'Diagn√≥stico CPU - 04 Dic', timestamp: new Date(), messages: [] }
        ]);
        const [currentConvId, setCurrentConvId] = useState(1);
        const [messages, setMessages] = useState([
            { id: 1, type: 'system', content: '¬°Bienvenido a SESOT! Soy tu asistente experto en diagn√≥stico de hardware. ¬øEn qu√© puedo ayudarte hoy?', timestamp: new Date() }
        ]);
        const [inputText, setInputText] = useState('');
        const [isTyping, setIsTyping] = useState(false);
        const [sidebarOpen, setSidebarOpen] = useState(true);
        const messagesEndRef = useRef(null);
        const inputRef = useRef(null);

        const scrollToBottom = () => {
            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
        };

        useEffect(() => {
            scrollToBottom();
        }, [messages]);

        const handleNewChat = () => {
            const newId = conversations.length + 1;
            const newConv = {
            id: newId,
            title: `Nueva consulta - ${new Date().toLocaleDateString('es-ES', { day: '2-digit', month: 'short' })}`,
            timestamp: new Date(),
            messages: []
            };
            setConversations([newConv, ...conversations]);
            setCurrentConvId(newId);
            setMessages([
            { id: 1, type: 'system', content: '¬°Hola! Estoy listo para ayudarte con un nuevo diagn√≥stico. ¬øQu√© dispositivo necesitas revisar?', timestamp: new Date() }
            ]);
        };

        const handleSendMessage = async () => {
            if (!inputText.trim()) return;

            const userMessage = {
            id: messages.length + 1,
            type: 'user',
            content: inputText,
            timestamp: new Date()
            };

            setMessages(prev => [...prev, userMessage]);
            setInputText('');
            setIsTyping(true);

            // Simulaci√≥n de respuesta del sistema experto
            setTimeout(() => {
            const systemResponse = {
                id: messages.length + 2,
                type: 'assistant',
                content: getExpertResponse(inputText),
                timestamp: new Date()
            };
            setMessages(prev => [...prev, systemResponse]);
            setIsTyping(false);
            }, 1000);
        };

        const getExpertResponse = (input) => {
            const lower = input.toLowerCase();
            
            if (lower.includes('cpu') || lower.includes('computadora') || lower.includes('pc')) {
            return 'üñ•Ô∏è **Diagn√≥stico de CPU iniciado**\n\n¬øEl equipo enciende (se ven luces o ventiladores funcionando)?';
            }
            
            if (lower.includes('impresora') || lower.includes('printer')) {
            return 'üñ®Ô∏è **Diagn√≥stico de Impresora iniciado**\n\n¬øCu√°l es el problema espec√≠fico?\n‚Ä¢ No imprime\n‚Ä¢ Imprime con manchas\n‚Ä¢ Atasco de papel';
            }
            
            if (lower.includes('si') || lower.includes('s√≠') || lower.includes('enciende')) {
            return '‚úÖ El equipo tiene energ√≠a. Ahora necesito saber:\n\n¬øSe muestra imagen en el monitor? (da video)';
            }
            
            if (lower.includes('no') && lower.includes('enciende')) {
            return '‚ö° **DIAGN√ìSTICO:** Fallo de alimentaci√≥n el√©ctrica\n\n**SOLUCI√ìN:**\n‚Ä¢ Verifica que el cable de poder est√© bien conectado\n‚Ä¢ Prueba con otro cable de poder\n‚Ä¢ Es probable que la fuente de poder est√© da√±ada\n\n¬øNecesitas ayuda con algo m√°s?';
            }
            
            if (lower.includes('no imprime') || lower.includes('no sale')) {
            return 'üîå **DIAGN√ìSTICO:** Problema de conectividad o cola de impresi√≥n\n\n**SOLUCIONES:**\n1. Revisa que el cable USB est√© bien conectado\n2. Verifica que est√© encendida la impresora\n3. Borra la cola de impresi√≥n en Windows\n4. Reinstala los drivers si persiste\n\n¬øResolvi√≥ el problema?';
            }
            
            if (lower.includes('mancha') || lower.includes('sucio')) {
            return 'üíß **DIAGN√ìSTICO:** Suciedad en cabezales o inyectores\n\n**SOLUCI√ìN:**\n‚Ä¢ Ejecuta limpieza de cabezales desde el software de la impresora\n‚Ä¢ Si persiste, limpieza manual con alcohol isoprop√≠lico\n‚Ä¢ Verifica nivel de tinta\n\n¬øNecesitas instrucciones detalladas?';
            }
            
            if (lower.includes('atasco') || lower.includes('papel')) {
            return 'üìÑ **DIAGN√ìSTICO:** Obstrucci√≥n mec√°nica\n\n**SOLUCI√ìN:**\n1. Apaga la impresora\n2. Abre todas las tapas\n3. Retira el papel con cuidado en direcci√≥n de los rodillos\n4. Verifica que no queden pedazos\n5. Enciende y prueba\n\n¬øPudiste resolverlo?';
            }
            
            return 'Entiendo tu consulta. Para poder ayudarte mejor, ¬øpodr√≠as especificar si el problema es con:\n\nüñ•Ô∏è **CPU/Computadora**\nüñ®Ô∏è **Impresora**\n\nO describe el s√≠ntoma espec√≠fico que observas.';
        };

        const handleKeyPress = (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            handleSendMessage();
            }
        };

        const selectConversation = (convId) => {
            setCurrentConvId(convId);
            const conv = conversations.find(c => c.id === convId);
            if (conv.messages.length === 0) {
            setMessages([
                { id: 1, type: 'system', content: '¬°Hola de nuevo! ¬øEn qu√© puedo ayudarte?', timestamp: new Date() }
            ]);
            } else {
            setMessages(conv.messages);
            }
        };

        return (
            <div className="flex h-screen bg-gray-50">
            {/* Sidebar - Historial de conversaciones */}
            <div className={`${sidebarOpen ? 'w-80' : 'w-0'} transition-all duration-300 bg-gray-900 text-white flex flex-col overflow-hidden`}>
                {/* Header Sidebar */}
                <div className="p-4 border-b border-gray-700">
                <div className="flex items-center justify-between mb-4">
                    <div className="flex items-center gap-2">
                    <Cpu className="w-6 h-6 text-blue-400" />
                    <h1 className="text-xl font-bold">SESOT</h1>
                    </div>
                    <button
                    onClick={() => setSidebarOpen(false)}
                    className="lg:hidden p-1 hover:bg-gray-800 rounded"
                    >
                    <X className="w-5 h-5" />
                    </button>
                </div>
                <button
                    onClick={handleNewChat}
                    className="w-full flex items-center gap-2 px-4 py-3 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors"
                >
                    <Plus className="w-5 h-5" />
                    <span className="font-medium">Nueva Consulta</span>
                </button>
                </div>

                {/* Lista de conversaciones */}
                <div className="flex-1 overflow-y-auto p-3 space-y-2">
                {conversations.map(conv => (
                    <button
                    key={conv.id}
                    onClick={() => selectConversation(conv.id)}
                    className={`w-full text-left p-3 rounded-lg transition-colors ${
                        currentConvId === conv.id
                        ? 'bg-gray-800 border border-gray-600'
                        : 'hover:bg-gray-800'
                    }`}
                    >
                    <div className="flex items-start gap-2">
                        <MessageSquare className="w-4 h-4 mt-1 flex-shrink-0" />
                        <div className="flex-1 min-w-0">
                        <p className="text-sm font-medium truncate">{conv.title}</p>
                        <p className="text-xs text-gray-400 mt-1">
                            {conv.timestamp.toLocaleDateString('es-ES', { 
                            day: '2-digit', 
                            month: 'short',
                            hour: '2-digit',
                            minute: '2-digit'
                            })}
                        </p>
                        </div>
                    </div>
                    </button>
                ))}
                </div>

                {/* Footer Sidebar */}
                <div className="p-4 border-t border-gray-700">
                <button className="w-full flex items-center gap-2 px-4 py-2 hover:bg-gray-800 rounded-lg transition-colors text-sm">
                    <Settings className="w-4 h-4" />
                    <span>Configuraci√≥n</span>
                </button>
                </div>
            </div>

            {/* √Årea principal de chat */}
            <div className="flex-1 flex flex-col">
                {/* Header */}
                <div className="bg-white border-b border-gray-200 px-6 py-4 flex items-center gap-4">
                {!sidebarOpen && (
                    <button
                    onClick={() => setSidebarOpen(true)}
                    className="p-2 hover:bg-gray-100 rounded-lg"
                    >
                    <Menu className="w-5 h-5" />
                    </button>
                )}
                <div className="flex items-center gap-3">
                    <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                    <Cpu className="w-6 h-6 text-white" />
                    </div>
                    <div>
                    <h2 className="text-lg font-semibold text-gray-900">Asistente de Diagn√≥stico</h2>
                    <p className="text-sm text-gray-500">Sistema Experto en Hardware</p>
                    </div>
                </div>
                </div>

                {/* √Årea de mensajes */}
                <div className="flex-1 overflow-y-auto p-6 space-y-6">
                {messages.map(message => (
                    <div
                    key={message.id}
                    className={`flex gap-4 ${message.type === 'user' ? 'justify-end' : 'justify-start'}`}
                    >
                    {message.type !== 'user' && (
                        <div className="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <Cpu className="w-5 h-5 text-white" />
                        </div>
                    )}
                    <div className={`max-w-2xl ${message.type === 'user' ? 'order-first' : ''}`}>
                        <div
                        className={`rounded-2xl px-4 py-3 ${
                            message.type === 'user'
                            ? 'bg-blue-600 text-white'
                            : message.type === 'system'
                            ? 'bg-purple-50 text-purple-900 border border-purple-200'
                            : 'bg-white text-gray-900 border border-gray-200'
                        }`}
                        >
                        <p className="whitespace-pre-line">{message.content}</p>
                        </div>
                        <p className="text-xs text-gray-400 mt-1 px-2">
                        {message.timestamp.toLocaleTimeString('es-ES', { 
                            hour: '2-digit', 
                            minute: '2-digit' 
                        })}
                        </p>
                    </div>
                    {message.type === 'user' && (
                        <div className="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                        <span className="text-sm font-semibold text-gray-700">U</span>
                        </div>
                    )}
                    </div>
                ))}

                {isTyping && (
                    <div className="flex gap-4">
                    <div className="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                        <Cpu className="w-5 h-5 text-white" />
                    </div>
                    <div className="bg-white border border-gray-200 rounded-2xl px-4 py-3">
                        <div className="flex gap-1">
                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }} />
                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }} />
                        <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }} />
                        </div>
                    </div>
                    </div>
                )}
                
                <div ref={messagesEndRef} />
                </div>

                {/* √Årea de input */}
                <div className="border-t border-gray-200 bg-white p-4">
                <div className="max-w-4xl mx-auto">
                    <div className="flex gap-3 items-end">
                    <div className="flex-1 bg-gray-50 border border-gray-300 rounded-2xl px-4 py-3 focus-within:border-blue-500 focus-within:ring-2 focus-within:ring-blue-200 transition-all">
                        <textarea
                        ref={inputRef}
                        value={inputText}
                        onChange={(e) => setInputText(e.target.value)}
                        onKeyPress={handleKeyPress}
                        placeholder="Describe el problema de tu dispositivo..."
                        className="w-full bg-transparent outline-none resize-none text-gray-900 placeholder-gray-400"
                        rows="1"
                        style={{ maxHeight: '120px' }}
                        />
                    </div>
                    <button
                        onClick={handleSendMessage}
                        disabled={!inputText.trim() || isTyping}
                        className="w-12 h-12 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white rounded-xl flex items-center justify-center transition-colors flex-shrink-0"
                    >
                        <Send className="w-5 h-5" />
                    </button>
                    </div>
                    <p className="text-xs text-gray-500 mt-2 text-center">
                    SESOT puede cometer errores. Verifica informaci√≥n cr√≠tica.
                    </p>
                </div>
                </div>
            </div>
            </div>
        );
        };

        export default SesotChatInterface;
                

        ReactDOM.render(<SesotChatInterface />, document.getElementById('root'));
    </script>
</body>
</html>